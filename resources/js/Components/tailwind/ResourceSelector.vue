<template>
        <div class="relative">
            <div class="font-bold text-grey-darker">
                <slot name="label"></slot>
            </div>

            <div class="mt-2">
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-grey-darker mb-3 leading-tight"
                       type="search"
                       :placeholder="placeholder"
                       :value="value"
                       @change="search($event)"
                       @input="search($event)"
                       @focus="focus"
                >
                <div v-if="! selected" class="absolute pin-0 bg-white rounded shadow-lg w-full">
                    <a href="#" class="block p-2 border-b" v-for="resource in response.data" :key="resource.id" @click.prevent="select(resource)">
                        <slot v-bind:resource="resource"></slot>
                    </a>
                </div>
            </div>
        </div>
</template>

<script>
    export default {
        props: {
            name: { required: true },
            placeholder: { default: '' },
            searchBy: { required: 'title' },
            url: { required: true },
            query: {
                type: Object,
                default: function () {
                    return {}
                }
            },
            title: { default: 'title' },
        },
        data() {
            return {
                selected: false,
                response: {},
                value: this.query[this.searchBy],
            }
        },
        methods: {
            focus() {
                this.selected = false;
                this.getResources();
            },
            select(resource) {
                this.selected = true;
                this.value = resource[this.title];

                this.$emit('select', resource)
            },
            search($event) {
                this.value = $event.target.value;
                this.query[this.searchBy] = $event.target.value;
                this.getResources();
            },
            getResources(value = null) {
                axios.get(this.url, { params: this.query })
                    .then(response => {
                        this.response = response.data;
                    })
                    .catch(errors => {
                        console.log(errors);
                    })
            }
        },
        created() {
            this.query[this.searchBy] = null;
        }
    }
</script>