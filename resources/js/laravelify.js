import * as _ from 'lodash';

export function route(key, params = false) {
	let route = _.find(window.routes, function (r) {
		return r.name === key;
	});

	if (!_.isObjectLike(route)) {
		console.log('Route ' + key + ' not found!');
		return key;
	}

	route = '/' + route.uri;
	if (params) {
		_.forEach(params, (param, index) => {
			route = _.replace(route, '{' + index + '}', param);
		});
	}

	if (window.proxy && window.proxy.length > 0) {
		route = window.proxy + '/' + route;
	}
	return route;
}

export function __(key, params = false) {
	let trans = _.get(window.trans, key, key);

	if (trans.substring(trans.length - 1) !== " ") {
		trans = trans + ' ';
	}

	if (params) {
		_.forEach(params, (param, index) => {
			if (trans.indexOf(':' + index + ' ') > 0) {
				trans = _.replace(trans, ':' + index, param);
			}
		});
	}

	if (trans.substring(trans.length - 1) !== " ") {
		trans = trans.substring(0, trans.length - 1);
	}

	return trans;
}

export function toEnglishNumber(input) {
	if (input === null) {
		return null;
	}

	if (input === undefined) {
		return undefined;
	}

	let output = input + '';
	output = output.replace(/۰/gi, '0');
	output = output.replace(/۱/gi, '1');
	output = output.replace(/۲/gi, '2');
	output = output.replace(/۳/gi, '3');
	output = output.replace(/۴/gi, '4');
	output = output.replace(/۵/gi, '5');
	output = output.replace(/۶/gi, '6');
	output = output.replace(/۷/gi, '7');
	output = output.replace(/۸/gi, '8');
	output = output.replace(/۹/gi, '9');

	return output;
}

export function toPersianNumber(input) {
	if (input === null) {
		return null;
	}

	if (input === undefined) {
		return undefined;
	}

	if (input === 0)
		return '۰'

	return persianJs(input).englishNumber()._str
}

export function removeComma(input) {
	if (input === null) {
		return null;
	}

	if (input === undefined) {
		return undefined;
	}

	let result = input + '';
	result = result.replace(/,/g, ''); // A string, so convert it to number
	result = result.replace(/٬/g, ''); // A string, so convert it to number
	result = result.replace(/،/g, ''); // A string, so convert it to number
	return result;
}

export function number_format(number, decimals, decPoint, thousandsSep) {

	number = (number + '').replace(/[^0-9+\-Ee.]/g, '')
	var n = !isFinite(+number) ? 0 : +number
	var prec = !isFinite(+decimals) ? 0 : Math.abs(decimals)
	var sep = (typeof thousandsSep === 'undefined') ? ',' : thousandsSep
	var dec = (typeof decPoint === 'undefined') ? '.' : decPoint
	var s = ''

	var toFixedFix = function (n, prec) {
		if (('' + n).indexOf('e') === -1) {
			return +(Math.round(n + 'e+' + prec) + 'e-' + prec)
		} else {
			var arr = ('' + n).split('e')
			var sig = ''
			if (+arr[1] + prec > 0) {
				sig = '+'
			}
			return (+(Math.round(+arr[0] + 'e' + sig + (+arr[1] + prec)) + 'e-' + prec)).toFixed(prec)
		}
	}

	// @todo: for IE parseFloat(0.55).toFixed(0) = 0;
	s = (prec ? toFixedFix(n, prec).toString() : '' + Math.round(n)).split('.')
	if (s[0].length > 3) {
		s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep)
	}
	if ((s[1] || '').length < prec) {
		s[1] = s[1] || ''
		s[1] += new Array(prec - s[1].length + 1).join('0')
	}

	return s.join(dec)
}
